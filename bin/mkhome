#!/usr/bin/env python

import sys, os

path_urls = '/home/finiks/notes/bookmarks.fnks'
path_output = '/home/finiks/www/temp/home/'

list_cat = []
list_urls = []

f_urls = open(path_urls, 'r')
i = -1
for line in f_urls:
    line = line.rstrip()
    if not line == '':
        if line[0] == '>':
            list_cat.append(line[2:])
            list_urls.append([])
            i += 1
        else:
            list_urls[i].append([line.rsplit(' ', 1)[0].rstrip(), line.split()[-1]])
f_urls.close()

css = '''body {
  background-image: url('patt.png');
  background-repeat: repeat;
  font-family: "Droid Sans Mono", monospace;
  font-size: 14px;
  margin-left: 7%;
  color: #999999;
}
a {
  color: #999999;
}
a:link,a:visited,a:active {
  text-decoration: none;
  color: #999999;
  font-weight: normal;
}
a:hover {
  text-decoration: none;
  border-bottom: 1px dotted;
  color: #999999;
  font-weight: normal;
}
h2 {
  color: b3b3b3;
  margin-top: 5px;
  margin-bottom: 5px;
  margin-left: -5px;
}
.grey {
  color: 454545;
}
.dgrey {
  color: 353535;
}
table {
  border-spacing: 8px;
}
  td:first-child {
  font-weight: bold;
  color: #999999
}
  td:nth-child(2) {
  font-weight: normal;
  color: b3b3b3;
}'''

links_html = ''
for index, item in enumerate(list_cat):
    links_html += '<div class="category"><h2>%s</h2><div class="urls">\n' % (item)
    for item2 in sorted(list_urls[index]):
        if item2[0][0] == '!':
            links_html += '<span class="hidden"><a href="%s">%s</a><br /></span>\n' % (item2[1], item2[0][1:])
        else:
            links_html += '<a href="%s">%s</a><br />\n' % (item2[1], item2[0])
    links_html += '</div></div>\n'

html = '''<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>home</title>
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Droid+Sans+Mono" />
  <link rel="stylesheet" type="text/css" href="style_homepage.css" />
</head>
<body>
  <table valign="middle" border="0" width="100%%" height="100%%"><tr><td>
  <span class="toggle"><span class="dgrey">finiks</span><span class="grey">@</span><span class="dgrey">localhost</span></span>
    %s
  </td></tr></table>
  <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="app_homepage.js"></script>
</body>
</html>''' % (links_html)

app = '''$('.urls').hide();
$('h2').hide()
$('.hidden').hide()
$(document).ready(function(){
  $('h2').fadeIn();
  $('.category').on('click', 'h2', function(){
    $('.urls').hide();
    $(this).closest('.category').find('.urls').fadeToggle();
  });
  $('body').on('click', '.toggle', function(){
    $('.hidden').show();
  });
});\n'''

with open(path_output+'index.html', 'w') as file:
    file.write(html)
with open(path_output+'style_homepage.css', 'w') as file:
    file.write(css)
with open(path_output+'app_homepage.js', 'w') as file:
    file.write(app)
